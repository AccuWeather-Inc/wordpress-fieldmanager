!function(){"use strict";var t,i,e,a,s,r,n,l,f;f={},t=jQuery,i=0,e=function(i){t(i).hasClass("ui-sortable")||t(i).sortable({handle:".fmjs-drag",items:"> .fm-item",placeholder:"sortable-placeholder",forcePlaceholderSize:!0,start:function(e,a){t(document).trigger("fm_sortable_drag",i)},stop:function(e,a){var s=a.item.parents(".fm-wrapper").first();r(s),t(document).trigger("fm_sortable_drop",i)}})},a=function(){t(".fmjs-sortable").each((function(){if(t(this).is(":visible"))e(this);else{var i=this;t(i).parents(".fm-group").bind("fm_collapsible_toggle",(function(){t(i).is(":visible")&&e(i)}))}}))},s=function(){t(".fm-label-with-macro").each((function(i){t(this).data("label-original",t(this).html());var e=t(this).parents(".fm-group").first().find(t(this).data("label-token"));if(e.length>0){var a=t(e[0]);if("function"==typeof a.val){var s=t(this),r=function(){var t="";if("SELECT"==a.prop("tagName")){var i=a.find("option:selected");i.val()&&(t=i.text())}else t=a.val();t.length>0?s.html(s.data("label-format").replace("%s",t)):s.html(s.data("label-original"))};a.on("change keyup",r),r()}}}))},r=function(e){e.each((function(){var e=t(this).data("fm-array-position")-0,a=0;e>0&&t(this).find("> .fm-item").each((function(){t(this).hasClass("fmjs-proto")||(t(this).find(".fm-element, .fm-incrementable").each((function(){var s=t(this).attr("name");if(s){var r=(s=s.replace(/\]/g,"")).split("[");if(r[e]!=a){r[e]=a;var n=r[0]+"["+r.slice(1).join("][")+"]";if(t(this).attr("name",n),t(this).attr("id")&&t(this).attr("id").match("-proto")&&!n.match("proto")){if(t(this).attr("id","fm-edit-dynamic-"+i),t(this).parent().hasClass("fm-option"))t(this).parent().find("label").attr("for","fm-edit-dynamic-"+i);else{var l=t(this).closest(".fm-item");l.length&&l.find(".fm-label label").length&&l.find(".fm-label label").attr("for","fm-edit-dynamic-"+i)}return void i++}}}t(this).hasClass("fm-incrementable")&&(t(this).attr("id","fm-edit-dynamic-"+i),i++)})),a++)})),t(this).find(".fm-wrapper").each((function(){r(t(this))}))}))},n=function(i){var e=t(i).data("display-value");try{e=e.split(",")}catch(t){e=[e]}return e},l=function(t,i){for(var e in t)if(t[e]==i)return!0;return!1},fmLoadModule((function(){t(document).on("click",".fm-add-another",(function(i){i.preventDefault(),function(i){var e=i.data("related-element"),n=i.data("limit")-0,l=i.parent().siblings(".fm-item").not(".fmjs-proto"),f=i.data("add-more-position")||"bottom";if(!(n>0&&l.length>=n)){var o=t(".fmjs-proto.fm-"+e,i.closest(".fm-wrapper")).first().clone();o.removeClass("fmjs-proto"),o="bottom"==f?o.insertBefore(i.parent()):o.insertAfter(i.parent()),r(i.parents(".fm-wrapper")),i.parent().siblings().last().trigger("fm_added_element"),s(),a()}}(t(this))})),t(document).on("click",".fmjs-remove",(function(i){var e,a;i.preventDefault(),a=(e=t(this)).parents(".fm-wrapper").first(),e.parents(".fm-item").first().remove(),r(a)})),t(document).on("click",".fmjs-collapsible-handle",(function(){t(this).parents(".fm-group").first().children(".fm-group-inner").slideToggle("fast"),r(t(this).parents(".fm-wrapper").first()),t(this).parents(".fm-group").first().trigger("fm_collapsible_toggle"),t(this).toggleClass("closed"),t(this).hasClass("closed")?t(this).attr("aria-expanded","false"):t(this).attr("aria-expanded","true")})),t(".fm-collapsed > .fm-group:not(.fmjs-proto) > .fm-group-inner").hide(),f.init_display_if=function(){var i,e=t(this).data("display-src"),a=n(this),s=t(this).siblings(".fm-"+e+"-wrapper").find(".fm-element").not("div, .fm-autocomplete, .fm-checkbox-hidden");0!==s.length&&(i=s.is(":checkbox")?s.is(":checked")?s.val():s.siblings('input[type=hidden][name="'+s.attr("name")+'"]').val():s.is(":radio")?s.filter(":checked").length?s.filter(":checked").val():"":s.val().split(","),s.addClass("display-trigger"),l(a,i)||t(this).hide())},t(".fm-display-if").each(f.init_display_if),f.trigger_display_if=function(){var i,e=t(this),a=e.attr("name");i=e.is(":checkbox")?e.is(":checked")?e.val():e.siblings('input[type=hidden][name="'+a+'"]').val():e.is(":radio")?e.filter(":checked").val():e.val().split(","),t(this).closest(".fm-wrapper").siblings().each((function(){t(this).hasClass("fm-display-if")&&a&&null!=a.match(t(this).data("display-src"))&&(l(n(this),i)?t(this).show():t(this).hide(),t(this).trigger("fm_displayif_toggle"))}))},t(document).on("change",".display-trigger",f.trigger_display_if),s(),a(),t(document).on("fm_activate_tab",a)}))}();
//# sourceMappingURL=fieldmanager.bundle.min.js.map