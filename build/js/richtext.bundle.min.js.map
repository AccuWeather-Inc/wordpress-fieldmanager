{"version":3,"sources":["webpack://Fieldmanager/./js/richtext.js"],"names":["fm","$","richtextarea","add_rte_to_visible_textareas","each","ed_id","mce_options","qt_options","proto_id","this","hasClass","addClass","attr","tinymce","tinyMCEPreInit","mceInit","data","closest","html","replace","RegExp","extend","body_class","selector","wp_skip_init","qtInit","id","mode_enabled","init","on","window","wpActiveEditor","slice","e","quicktags","QTags","indexOf","_buttonsInit","reload_editors","wrap","nodeType","cmd","html_mode","ed","get","content","getContent","click","parseInt","majorVersion","execCommand","setContent","el","length","reset_core_editor_mode","core_editor_state","setUserSetting","should_readd_rte","classList","contains","querySelector","document","aid","l","substr","mode","setTimeout","getUserSetting","fmLoadModule","obj","item","jQuery"],"mappings":"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","file":"js/richtext.bundle.min.js","sourcesContent":["if ('undefined' === typeof fm) {\n\tvar fm = {};\n}\n\n( function( $ ) {\n\tfm.richtextarea = {\n\t\tadd_rte_to_visible_textareas: function() {\n\t\t\t$( 'textarea.fm-richtext:visible' ).each( function() {\n\t\t\t\tif ( ! $( this ).hasClass( 'fm-tinymce' ) ) {\n\t\t\t\t\tvar init, ed_id, mce_options, qt_options, proto_id;\n\t\t\t\t\t$( this ).addClass( 'fm-tinymce' );\n\t\t\t\t\ted_id = $( this ).attr( 'id' );\n\n\t\t\t\t\tif ( typeof tinymce !== 'undefined' ) {\n\n\t\t\t\t\t\tif ( typeof tinyMCEPreInit.mceInit[ ed_id ] === 'undefined' ) {\n\t\t\t\t\t\t\tproto_id = $( this ).data( 'proto-id' );\n\n\t\t\t\t\t\t\t// Clean up the proto id which appears in some of the wp_editor generated HTML\n\t\t\t\t\t\t\t$( this ).closest( '.fm-wrapper' ).html( $( this ).closest( '.fm-wrapper' ).html().replace( new RegExp( proto_id, 'g' ), ed_id ) );\n\n\t\t\t\t\t\t\t// This needs to be initialized, so we need to get the options from the proto\n\t\t\t\t\t\t\tif ( proto_id && typeof tinyMCEPreInit.mceInit[ proto_id ] !== 'undefined' ) {\n\t\t\t\t\t\t\t\tmce_options = $.extend( true, {}, tinyMCEPreInit.mceInit[ proto_id ] );\n\t\t\t\t\t\t\t\tmce_options.body_class = mce_options.body_class.replace( proto_id, ed_id );\n\t\t\t\t\t\t\t\tmce_options.selector = mce_options.selector.replace( proto_id, ed_id );\n\t\t\t\t\t\t\t\tmce_options.wp_skip_init = false;\n\t\t\t\t\t\t\t\ttinyMCEPreInit.mceInit[ ed_id ] = mce_options;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// TODO: No data to work with, this should throw some sort of error\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ( proto_id && typeof tinyMCEPreInit.qtInit[ proto_id ] !== 'undefined' ) {\n\t\t\t\t\t\t\t\tqt_options = $.extend( true, {}, tinyMCEPreInit.qtInit[ proto_id ] );\n\t\t\t\t\t\t\t\tqt_options.id = qt_options.id.replace( proto_id, ed_id );\n\t\t\t\t\t\t\t\ttinyMCEPreInit.qtInit[ ed_id ] = qt_options;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif ( 'html' !== fm.richtextarea.mode_enabled( this ) ) {\n\t\t\t\t\t\t\t\ttinymce.init( tinyMCEPreInit.mceInit[ ed_id ] );\n\t\t\t\t\t\t\t\t$( this ).closest( '.wp-editor-wrap' ).on( 'click.wp-editor', function() {\n\t\t\t\t\t\t\t\t\tif ( this.id ) {\n\t\t\t\t\t\t\t\t\t\twindow.wpActiveEditor = this.id.slice( 3, -5 );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e){}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif ( typeof tinyMCEPreInit.qtInit[ ed_id ] !== 'undefined' ) {\n\t\t\t\t\t\t\t\tquicktags( tinyMCEPreInit.qtInit[ ed_id ] );\n\t\t\t\t\t\t\t\t// _buttonsInit() only needs to be called on dynamic editors\n\t\t\t\t\t\t\t\t// quicktags() handles it for us on the first initialization\n\t\t\t\t\t\t\t\tif ( typeof QTags !== 'undefined' && -1 !== ed_id.indexOf( '-dynamic-' ) ) {\n\t\t\t\t\t\t\t\t\tQTags._buttonsInit();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch(e){};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t},\n\n\t\treload_editors: function( e, wrap ) {\n\t\t\tif ( ! wrap || 'undefined' === typeof wrap.nodeType ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$( '.fm-tinymce', wrap ).each( function() {\n\t\t\t\tvar html_mode = ( 'html' === fm.richtextarea.mode_enabled( this ) )\n\t\t\t\t\t, ed = tinymce.get( this.id )\n\t\t\t\t\t, content = ed.getContent()\n\t\t\t\t\t, cmd;\n\n\t\t\t\tif ( html_mode ) {\n\t\t\t\t\t$( '#' + this.id + '-tmce' ).click();\n\t\t\t\t}\n\n\t\t\t\t// Disable the editor\n\t\t\t\tcmd = 'mceRemoveControl';\n\t\t\t\tif ( parseInt( tinymce.majorVersion ) >= 4 ) {\n\t\t\t\t\tcmd = 'mceRemoveEditor';\n\t\t\t\t}\n\t\t\t\ttinymce.execCommand( cmd, false, this.id );\n\n\t\t\t\t// Immediately re-enable the editor\n\t\t\t\tcmd = 'mceAddControl';\n\t\t\t\tif ( parseInt( tinymce.majorVersion ) >= 4 ) {\n\t\t\t\t\tcmd = 'mceAddEditor';\n\t\t\t\t}\n\t\t\t\ttinymce.execCommand( cmd, false, this.id );\n\n\t\t\t\t// Replace the content with what it was to correct paragraphs\n\t\t\t\ted = tinymce.get( this.id );\n\t\t\t\ted.setContent( content );\n\n\t\t\t\tif ( html_mode ) {\n\t\t\t\t\t$( '#' + this.id + '-html' ).click();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tmode_enabled: function( el ) {\n\t\t\treturn $( el ).closest( '.html-active' ).length ? 'html' : 'tinymce';\n\t\t},\n\n\t\t/**\n\t\t * Ensure that the main editor's state remains unaffected by any FM editors\n\t\t */\n\t\treset_core_editor_mode: function() {\n\t\t\tif ( 'html' === core_editor_state || 'tinymce' === core_editor_state ) {\n\t\t\t\tsetUserSetting( 'editor', core_editor_state );\n\t\t\t}\n\t\t},\n\n\t\tshould_readd_rte: function( e, el ) {\n\t\t\tif (\n\t\t\t\t! el.classList.contains( 'closed' ) &&\n\t\t\t\tel.querySelector( 'textarea.fm-richtext') &&\n\t\t\t\t! el.querySelector( 'textarea.fm-tinymce' )\n\t\t\t) {\n\t\t\t\tfm.richtextarea.add_rte_to_visible_textareas();\n\t\t\t}\n\t\t}\n\t}\n\t$( document ).on( 'fm_collapsible_toggle fm_added_element fm_activate_tab fm_displayif_toggle', fm.richtextarea.add_rte_to_visible_textareas );\n\t$( document ).on( 'fm_sortable_drop', fm.richtextarea.reload_editors );\n\t$( document ).on( 'postbox-toggled', fm.richtextarea.should_readd_rte );\n\n\t$( document ).on( 'click', '.fm-richtext .wp-switch-editor', function() {\n\t\tvar aid = this.id,\n\t\t\tl = aid.length,\n\t\t\tid = aid.substr( 0, l - 5 ),\n\t\t\tmode = 'html' === aid.substr( l - 4 ) ? 'html' : 'tinymce';\n\n\t\t// This only runs if the default editor is set to 'cookie'\n\t\tif ( 'fm-edit-dynamic' !== id.substr( 0, 15 ) && $( this ).closest( '.fm-richtext-remember-editor' ).length ) {\n\t\t\tsetUserSetting( 'editor_' + id.replace( /-/g, '_' ).replace( /[^a-z0-9_]/ig, '' ), mode );\n\t\t}\n\n\t\t// Reset the core editor's state so it remains unaffected by this event.\n\t\t// We delay by 50ms to ensure that this event has enough time to run.\n\t\t// WordPress won't change the state of the editor until the end of the\n\t\t// event delegation.\n\t\tsetTimeout( fm.richtextarea.reset_core_editor_mode, 50 );\n\t} );\n\n\tvar core_editor_state = getUserSetting( 'editor' );\n\n\t/**\n\t * If the main editor's state changes, note that change.\n\t */\n\t$( document ).on( 'click', '#content-tmce,#content-html', function() {\n\t\tvar aid = this.id,\n\t\t\tl = aid.length,\n\t\t\tid = aid.substr( 0, l - 5 ),\n\t\t\tmode = 'html' === aid.substr( l - 4 ) ? 'html' : 'tinymce';\n\n\t\tcore_editor_state = mode;\n\t} );\n\n\t/**\n\t * On document.load, init the editors and make the global meta box drag-drop\n\t * event reload the editors.\n\t */\n\tfmLoadModule(\n\t\tfunction() {\n\t\t\tfm.richtextarea.add_rte_to_visible_textareas();\n\t\t\t$( '.meta-box-sortables' ).on( 'sortstop', function( e, obj ) {\n\t\t\t\tfm.richtextarea.reload_editors( e, obj.item[0] );\n\t\t\t} );\n\t\t}\n\t);\n} ) ( jQuery );\n"],"sourceRoot":""}